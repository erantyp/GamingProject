<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ê°• ê±´ë„ˆê¸° í¼ì¦ â›µ (Animated Boat)</title>
<style>
  :root{
    --bg:#f7fbff; --ink:#1f2937; --muted:#64748b; --accent:#0ea5e9;
    --good:#16a34a; --bad:#ef4444; --card:#ffffffcc;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple SD Gothic Neo,"Malgun Gothic",sans-serif;
    color:var(--ink); background:
      radial-gradient(900px 420px at 20% 10%, #fff7e6 0%, transparent 60%),
      radial-gradient(900px 420px at 80% 20%, #e6f7ff 0%, transparent 60%),
      radial-gradient(900px 420px at 50% 90%, #f6ffed 0%, transparent 60%), var(--bg);
  }
  .container{max-width:1100px;margin:0 auto;padding:20px}
  .center-col{min-height:100dvh;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px}

  /* Buttons */
  .btn{display:block;width:min(420px,80vw);padding:14px 16px;border-radius:14px;border:1px solid #dbe5ef;
      font-size:18px;font-weight:700;text-align:center;cursor:pointer;background:#fff;box-shadow:0 10px 24px rgba(0,0,0,.06);
      transition:transform .15s ease,box-shadow .15s ease}
  .btn:hover{transform:translateY(-2px);box-shadow:0 16px 30px rgba(0,0,0,.08)}
  .btn.primary{background:linear-gradient(180deg,#38bdf8,#0ea5e9);color:#fff;border:none}
  .btn.ghost{background:#fff}
  .btn.small{width:auto;padding:10px 14px;font-size:16px}

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:10}
  .modal{background:#fff;border-radius:16px;padding:20px;max-width:640px;box-shadow:0 20px 60px rgba(0,0,0,.25)}
  .modal h3{margin:0 0 8px} .modal p{margin:8px 0 0;line-height:1.6;color:var(--muted)}

  /* Game */
  .hud{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:10px 0 18px;flex-wrap:wrap}
  .pill{padding:6px 10px;border-radius:999px;background:#eef6ff;color:#1d4ed8;border:1px solid #c7dbff;font-weight:700}
  .hud .right{display:flex;gap:8px;align-items:center}

  .board{position:relative;width:100%;height:520px;border-radius:18px;overflow:hidden;border:1px solid #e5e7eb;background:#dff3ff;box-shadow:0 10px 24px rgba(0,0,0,.06)}
  /* River: vertical stripe */
  .river{position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);width:min(38%,420px);
    background:linear-gradient(180deg, rgba(255,255,255,.4), rgba(255,255,255,0) 30%),
               repeating-linear-gradient(180deg, rgba(255,255,255,.18) 0 6px, rgba(255,255,255,0) 6px 18px),
               linear-gradient(180deg,#8dd7ff,#54b9f0 60%,#4aa8e0);}
  .bank{position:absolute;top:0;bottom:0;width:31%;display:flex;flex-direction:column;justify-content:flex-end;gap:8px;padding:10px}
  .bank.left{left:0} .bank.right{right:0}
  .bank::before{content:"";position:absolute;top:0;bottom:0;width:18px;background:linear-gradient(180deg,#e7f6d3,#cfe9a6)}
  .bank.left::before{right:0} .bank.right::before{left:0}
  .bank-title{position:absolute;top:8px;left:50%;transform:translateX(-50%);font-weight:800;background:#ffffffb5;padding:2px 10px;border-radius:999px;border:1px solid #e5e7eb}
  .dock{display:flex;flex-wrap:wrap;gap:8px;z-index:2}

  /* Boat wrapper with motion */
  .boat-wrap{position:absolute;top:55%;transform:translate(-50%,-50%); /* left is set via JS */ 
             transition:left 1s ease-in-out; /* motion duration */}
  .boat{position:relative;width:320px;max-width:80%;height:110px;pointer-events:auto;border-radius:12px;background:#8b5a2b;
        box-shadow:0 12px 0 #5a3817 inset,0 -8px 0 #b37a43 inset,0 20px 40px rgba(0,0,0,.25);border:2px solid #5a3817}
  .boat::after{content:"";position:absolute;left:50%;top:-64px;width:6px;height:64px;background:#5a3817;box-shadow:0 2px 0 #00000022}
  .flag{position:absolute;left:calc(50% + 3px);top:-54px;width:54px;height:24px;background:linear-gradient(90deg,#38bdf8,#0ea5e9);clip-path:polygon(0 0,100% 0,80% 50%,100% 100%,0 100%)}
  .slots{position:absolute;left:8px;right:8px;bottom:8px;height:88px;display:flex;gap:10px;justify-content:center;align-items:flex-end}
  .slot{width:80px;height:80px;border:2px dashed #ffffff99;border-radius:12px;background:#ffffff22;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;user-select:none}

  /* Tokens */
  .token{width:80px;height:80px;border-radius:16px;display:flex;align-items:center;justify-content:center;background:var(--card);
         border:1px solid #e5e7eb;box-shadow:0 8px 20px rgba(0,0,0,.08);cursor:grab;user-select:none;font-size:42px}
  .token:active{cursor:grabbing}
  .token .label{font-size:12px;color:#334155;font-weight:800;position:absolute;bottom:6px;background:#fff;padding:1px 6px;border-radius:999px;border:1px solid #e5e7eb}

  .hidden{display:none !important}

  /* Result overlay */
  .result{position:absolute;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:5}
  .result .card{background:#fff;border-radius:18px;padding:24px;width:min(520px,88vw);text-align:center;box-shadow:0 24px 80px rgba(0,0,0,.35)}
  .result h2{margin:0 0 10px} .result p{margin:6px 0 16px;color:var(--muted)} .result .time{font-weight:800;color:#0f766e}

  @media (max-width: 720px){
    .board{height:560px}
    .token{width:72px;height:72px;font-size:36px}
    .slot{width:72px;height:72px}
  }
</style>
</head>
<body>

<!-- ===== MENU ===== -->
<main id="menu" class="center-col">
  <h1>ê°• ê±´ë„ˆê¸° í¼ì¦ â›µ</h1>
  <button class="btn primary" id="startBtn">ğŸš€ ê²Œì„ ì‹¤í–‰</button>
  <button class="btn ghost" id="rulesBtn">ğŸ“œ ê²Œì„ ê·œì¹™</button>
</main>

<!-- Rules Modal -->
<div id="rulesModal" class="modal-backdrop" aria-hidden="true">
  <div class="modal">
    <h3>ê²Œì„ ê·œì¹™</h3>
    <p>
      ë‹¹ì‹ ì€ <b>ëŠ‘ëŒ€, ì–‘, ì–‘ë°°ì¶”</b>ë¥¼ ë³´íŠ¸ë¡œ ê°• ê±´ë„ˆí¸ìœ¼ë¡œ ì˜®ê²¨ì•¼ í•©ë‹ˆë‹¤. ë³´íŠ¸ì—ëŠ” ë°˜ë“œì‹œ <b>ì‚¬ëŒ</b>ì´ íƒ€ ìˆì–´ì•¼ í•˜ë©°,
      í•œ ë²ˆì— ì‹¤ì„ ìˆ˜ ìˆëŠ” ê²ƒì€ <b>ì‚¬ëŒ + 1ê°œ</b>ë¿ì…ë‹ˆë‹¤. ì‚¬ëŒì´ ì—†ëŠ” ë‘‘ì—ì„œ <b>ëŠ‘ëŒ€ì™€ ì–‘</b>ì´ í•¨ê»˜ ë‚¨ìœ¼ë©´ ì–‘ì´ ë¨¹íˆê³ ,
      <b>ì–‘ê³¼ ì–‘ë°°ì¶”</b>ê°€ í•¨ê»˜ ë‚¨ìœ¼ë©´ ì–‘ë°°ì¶”ê°€ ë¨¹í˜€ <b>ê²Œì„ ì˜¤ë²„</b>ê°€ ë©ë‹ˆë‹¤. ë„¤ ëŒ€ìƒì„ ëª¨ë‘ ì•ˆì „í•˜ê²Œ ì˜¤ë¥¸ìª½ ë‘‘ìœ¼ë¡œ ì˜®ê²¨ ë³´ì„¸ìš”!
    </p>
    <div style="margin-top:14px;display:flex;gap:8px;justify-content:flex-end">
      <button class="btn small ghost" id="rulesClose">ë‹«ê¸°</button>
      <button class="btn small primary" id="rulesStart">ë°”ë¡œ ì‹œì‘</button>
    </div>
  </div>
</div>

<!-- ===== GAME ===== -->
<section id="game" class="container hidden">
  <div class="hud">
    <div class="left">
      <span class="pill">ë³´íŠ¸ ìœ„ì¹˜: <b id="boatSideLabel">ì™¼ìª½ ë‘‘</b></span>
      <span class="pill">ê²½ê³¼ì‹œê°„: <b id="elapsed">00:00</b></span>
    </div>
    <div class="right">
      <button class="btn small ghost" id="toMenu">ë©”ë‰´</button>
      <button class="btn small" id="reset">ì´ˆê¸°í™”</button>
      <button class="btn small primary" id="moveBtn">â›µ ì´ë™</button>
    </div>
  </div>

  <div class="board" id="board">
    <div class="bank left">
      <div class="bank-title">ğŸŒ¿ ì™¼ìª½ ë‘‘</div>
      <div class="dock" id="dock-left"></div>
    </div>

    <div class="river"></div>

    <!-- ì›€ì§ì´ëŠ” ë³´íŠ¸ ë˜í¼ (left %ë¥¼ JSë¡œ ë³€ê²½) -->
    <div class="boat-wrap" id="boatWrap">
      <div class="boat" id="boat">
        <div class="flag"></div>
        <div class="slots">
          <div class="slot" data-slot="person">ì‚¬ëŒ</div>
          <div class="slot" data-slot="cargo">í™”ë¬¼</div>
        </div>
      </div>
    </div>

    <div class="bank right">
      <div class="bank-title">ğŸï¸ ì˜¤ë¥¸ìª½ ë‘‘</div>
      <div class="dock" id="dock-right"></div>
    </div>

    <!-- ê²°ê³¼ -->
    <div class="result" id="overlay-win" aria-hidden="true">
      <div class="card">
        <h2>ğŸ† ì„±ê³µ!</h2>
        <p>ëª¨ë‘ ì•ˆì „í•˜ê²Œ ê°•ì„ ê±´ë„œìŠµë‹ˆë‹¤.</p>
        <p class="time">í´ë¦¬ì–´ ì‹œê°„: <span id="clearTime">00:00</span></p>
        <button class="btn primary" id="replayWin">ğŸ” ë¦¬í”Œë ˆì´</button>
      </div>
    </div>

    <div class="result" id="overlay-lose" aria-hidden="true">
      <div class="card">
        <h2>âŒ ê²Œì„ ì˜¤ë²„</h2>
        <p id="loseReason">ê·œì¹™ ìœ„ë°˜ìœ¼ë¡œ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
        <button class="btn primary" id="replayLose">ğŸ” ë‹¤ì‹œ ë„ì „</button>
      </div>
    </div>
  </div>
</section>

<script>
/* ========= State ========= */
const $ = s => document.querySelector(s);
const TOKENS = ['person','wolf','goat','cabbage'];
const EMOJI  = {person:'ğŸ§', wolf:'ğŸº', goat:'ğŸ‘', cabbage:'ğŸ¥¬'};
const LABEL  = {person:'ì‚¬ëŒ', wolf:'ëŠ‘ëŒ€', goat:'ì–‘', cabbage:'ì–‘ë°°ì¶”'};

const state = {
  positions: { person:'L', wolf:'L', goat:'L', cabbage:'L' }, // 'L' | 'R' | 'BOAT'
  boatSide : 'L',     // 'L' or 'R'
  moving   : false,   // ì• ë‹ˆë©”ì´ì…˜ ì¤‘ ì ê¸ˆ
  startTs  : null,
  timerId  : null
};

const leftDock  = $('#dock-left');
const rightDock = $('#dock-right');
const boat      = $('#boat');
const boatWrap  = $('#boatWrap');
const boatSideLabel = $('#boatSideLabel');
const BOAT_SPEED_MS = 1000; // CSS transitionê³¼ ë™ì¼í•˜ê²Œ

/* ========= Helpers ========= */
function boatLeftPercent(side){
  // ë³´íŠ¸ê°€ ê°•ì—ì„œ ì™¼ìª½/ì˜¤ë¥¸ìª½ ê°€ì¥ìë¦¬ ê·¼ì²˜ë¡œ ì´ë™í•˜ë„ë¡ ì¢Œí‘œ ì •ì˜
  // ë³´ë“œ ê¸°ì¤€: ì™¼ìª½ ë‘‘ 31%, ê°• 38%, ì˜¤ë¥¸ìª½ ë‘‘ 31%
  // ê°• ì•ˆìª½ ê°€ì¥ìë¦¬ì—ì„œ ì•½ê°„ ì•ˆìª½ìœ¼ë¡œ: 36% / 64%
  return side === 'L' ? 36 : 64;
}
function formatTime(ms){
  const s = Math.floor(ms/1000), m = Math.floor(s/60);
  return `${m.toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;
}
function startTimer(){
  state.startTs = Date.now();
  clearInterval(state.timerId);
  state.timerId = setInterval(()=> $('#elapsed').textContent = formatTime(Date.now()-state.startTs), 200);
}
function stopTimer(){ clearInterval(state.timerId); state.timerId = null; }

/* ========= Build tokens ========= */
const elements = {};
function makeToken(name){
  const el = document.createElement('div');
  el.className = 'token';
  el.draggable = true;
  el.dataset.id = name;
  el.innerHTML = `<div style="position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center">
    <span>${EMOJI[name]}</span><span class="label">${LABEL[name]}</span></div>`;
  el.addEventListener('dragstart', e=>{
    if (state.moving){ e.preventDefault(); return; }
    e.dataTransfer.setData('text/plain', name);
  });
  return el;
}
TOKENS.forEach(n => elements[n] = makeToken(n));

/* ========= Rules ========= */
function checkFail(){
  const bank = { L:[], R:[] };
  TOKENS.forEach(name=>{
    const loc = state.positions[name]==='BOAT' ? state.boatSide : state.positions[name];
    bank[loc].push(name);
  });
  if (!bank['L'].includes('person')){
    if (bank['L'].includes('wolf') && bank['L'].includes('goat')) return 'ì™¼ìª½ ë‘‘ì—ì„œ ëŠ‘ëŒ€ê°€ ì–‘ì„ ë¨¹ì—ˆì–´ìš”! ğŸºâ¡ï¸ğŸ‘';
    if (bank['L'].includes('goat') && bank['L'].includes('cabbage')) return 'ì™¼ìª½ ë‘‘ì—ì„œ ì–‘ì´ ì–‘ë°°ì¶”ë¥¼ ë¨¹ì—ˆì–´ìš”! ğŸ‘â¡ï¸ğŸ¥¬';
  }
  if (!bank['R'].includes('person')){
    if (bank['R'].includes('wolf') && bank['R'].includes('goat')) return 'ì˜¤ë¥¸ìª½ ë‘‘ì—ì„œ ëŠ‘ëŒ€ê°€ ì–‘ì„ ë¨¹ì—ˆì–´ìš”! ğŸºâ¡ï¸ğŸ‘';
    if (bank['R'].includes('goat') && bank['R'].includes('cabbage')) return 'ì˜¤ë¥¸ìª½ ë‘‘ì—ì„œ ì–‘ì´ ì–‘ë°°ì¶”ë¥¼ ë¨¹ì—ˆì–´ìš”! ğŸ‘â¡ï¸ğŸ¥¬';
  }
  return null;
}
function checkWin(){ return TOKENS.every(k => state.positions[k]==='R'); }

/* ========= Render ========= */
function render(){
  leftDock.innerHTML = ''; rightDock.innerHTML = '';
  TOKENS.forEach(name=>{
    const pos = state.positions[name], el = elements[name];
    if (pos==='L') leftDock.appendChild(el);
    else if (pos==='R') rightDock.appendChild(el);
    else if (pos==='BOAT'){
      const slot = boat.querySelector(`[data-slot="${name==='person'?'person':'cargo'}"]`);
      slot.innerHTML = ''; slot.appendChild(el);
    }
  });
  const personSlot = boat.querySelector('[data-slot="person"]');
  const cargoSlot  = boat.querySelector('[data-slot="cargo"]');
  if (!personSlot.querySelector('.token')) personSlot.textContent = 'ì‚¬ëŒ';
  if (!cargoSlot.querySelector('.token'))  cargoSlot.textContent  = 'í™”ë¬¼';

  // ë³´íŠ¸ ìœ„ì¹˜ ë¼ë²¨ + ì¢Œí‘œ
  boatSideLabel.textContent = state.boatSide==='L' ? 'ì™¼ìª½ ë‘‘' : 'ì˜¤ë¥¸ìª½ ë‘‘';
  boatWrap.style.left = boatLeftPercent(state.boatSide) + '%';

  // ì—”ë“œ ìŠ¤í…Œì´íŠ¸
  const lose = checkFail();
  if (lose){ gameOver(lose); return; }
  if (checkWin()){ win(); }
}

/* ========= DnD ========= */
function onBoatDragOver(ev){ if (!state.moving) ev.preventDefault(); }
function onDockDragOver(ev){ if (!state.moving) ev.preventDefault(); }

boat.addEventListener('dragover', onBoatDragOver);
boat.addEventListener('drop', ev=>{
  if (state.moving) return;
  ev.preventDefault();
  const name = ev.dataTransfer.getData('text/plain'); if (!name) return;
  const sameSide = (state.positions[name]===state.boatSide) || (state.positions[name]==='BOAT');
  if (!sameSide) return; // ë°˜ëŒ€ ë‘‘ ìˆœê°„ì´ë™ ê¸ˆì§€
  const personOn = state.positions.person==='BOAT';
  const cargoOn  = ['wolf','goat','cabbage'].some(id=>state.positions[id]==='BOAT');
  if (name==='person'){
    state.positions.person='BOAT';
  }else{
    if (cargoOn && state.positions[name]!=='BOAT') return; // í™”ë¬¼ 1ê°œ ì œí•œ
    state.positions[name]='BOAT';
  }
  render();
});
[leftDock,rightDock].forEach(dock=>{
  dock.addEventListener('dragover', onDockDragOver);
  dock.addEventListener('drop', ev=>{
    if (state.moving) return;
    ev.preventDefault();
    const name = ev.dataTransfer.getData('text/plain'); if (!name) return;
    const targetSide = dock.id==='dock-left' ? 'L' : 'R';
    if (state.boatSide!==targetSide) return;          // ë³´íŠ¸ ì—†ëŠ” ë‘‘ í•˜ì„  ê¸ˆì§€
    if (state.positions[name]!=='BOAT') return;       // ë³´íŠ¸ì— íƒ„ ê²½ìš°ë§Œ
    state.positions[name]=targetSide; render();
  });
});

/* ========= Motion: move boat with animation ========= */
function moveBoat(){
  if (state.moving) return;
  if (state.positions.person!=='BOAT') return; // ì‚¬ëŒ í•„ìˆ˜

  state.moving = true;
  // ë‹¤ìŒ ìª½ìœ¼ë¡œ ë³´íŠ¸ ìœ„ì¹˜ë§Œ ë¨¼ì € ë°”ê¿ˆ(ìŠ¹ê°ì€ ì•„ì§ BOAT ìƒíƒœ ìœ ì§€)
  state.boatSide = (state.boatSide==='L') ? 'R' : 'L';
  // ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°: left % ë³€ê²½
  boatWrap.style.left = boatLeftPercent(state.boatSide) + '%';

  // ì• ë‹ˆë©”ì´ì…˜ ëë‚œ ë’¤ ë„ì°© ì²˜ë¦¬(ìë™ í•˜ì„ )
  const onDone = ()=>{
    boatWrap.removeEventListener('transitionend', onDone);
    const arrive = state.boatSide;
    TOKENS.forEach(k=>{ if (state.positions[k]==='BOAT') state.positions[k]=arrive; });
    state.moving = false;
    render();
  };
  // transitionendê°€ ë¸Œë¼ìš°ì € ë³„ë¡œ ì•ˆ ì¡íˆëŠ” ê²½ìš° ëŒ€ë¹„ íƒ€ì„ì•„ì›ƒ ë°±ì—…
  boatWrap.addEventListener('transitionend', onDone, {once:true});
  setTimeout(()=>{ if (state.moving) onDone(); }, BOAT_SPEED_MS + 80);
}

/* ========= Overlays ========= */
function win(){ stopTimer(); $('#clearTime').textContent = formatTime(Date.now()-state.startTs); $('#overlay-win').style.display='flex'; }
function gameOver(msg){ stopTimer(); $('#loseReason').textContent = msg || 'ê·œì¹™ ìœ„ë°˜ìœ¼ë¡œ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'; $('#overlay-lose').style.display='flex'; }
function hideOverlays(){ $('#overlay-win').style.display='none'; $('#overlay-lose').style.display='none'; }

/* ========= Lifecycle ========= */
function resetGame(){
  state.positions = { person:'L', wolf:'L', goat:'L', cabbage:'L' };
  state.boatSide = 'L'; state.moving=false; hideOverlays(); startTimer();
  // ì´ˆê¸° ë³´íŠ¸ ì¢Œí‘œ ì„¸íŒ…(ë Œë” ì „ì— ìœ„ì¹˜ ì¡ê¸°)
  boatWrap.style.left = boatLeftPercent('L') + '%';
  render();
}
function enterGame(){ $('#menu').classList.add('hidden'); $('#game').classList.remove('hidden'); resetGame(); }
function enterMenu(){ $('#menu').classList.remove('hidden'); $('#game').classList.add('hidden'); hideOverlays(); stopTimer(); }

/* ========= Wire up ========= */
document.getElementById('startBtn').addEventListener('click', enterGame);
document.getElementById('rulesBtn').addEventListener('click', ()=> $('#rulesModal').style.display='flex');
document.getElementById('rulesClose').addEventListener('click', ()=> $('#rulesModal').style.display='none');
document.getElementById('rulesStart').addEventListener('click', ()=>{ $('#rulesModal').style.display='none'; enterGame(); });

document.getElementById('moveBtn').addEventListener('click', moveBoat);
document.getElementById('reset').addEventListener('click', resetGame);
document.getElementById('toMenu').addEventListener('click', enterMenu);
document.getElementById('replayWin').addEventListener('click', resetGame);
document.getElementById('replayLose').addEventListener('click', resetGame);

/* ========= Init ========= */
(function initTokens(){
  TOKENS.forEach(n => leftDock.appendChild(elements[n]));
})();
</script>
</body>
</html>
